{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Muli" />
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/home_2.css' %}">
   
    <title>Main</title>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-panel">
            <div class="userinformation">
                <div class="greenbox">
                    <div class="user text-center">{{nickname}}</div>
                </div>
                <div class="username">{{fullname}}</div>
                <div class="email-sidebar">{{email}}</div>
            </div>
            <div class="utilities">
                <div class="options newgroup">Create a group</div>
                <div class="options singleuser">Search a Friend</div>
                <div class="options viewprofile">View Profile</div>
                <div class="options">About the developer</div>
                <div class="options logout">Logout</div>
            </div>
        </div>
    </div>
    <nav class="navbar bg-custom navbar-expand-xs fixed-top navbar-default">
        <div class="hamburger d-flex">
            <div>
                <svg class = 'bars' width="2em" height="2em" viewBox="0 0 16 16" fill="#fff">
                    <path fill-rule="evenodd" d="M5.5 2A3.5 3.5 0 0 0 2 5.5v5A3.5 3.5 0 0 0 5.5 14h5a3.5 3.5 0 0 0 3.5-3.5V8a.5.5 0 0 1 1 0v2.5a4.5 4.5 0 0 1-4.5 4.5h-5A4.5 4.5 0 0 1 1 10.5v-5A4.5 4.5 0 0 1 5.5 1H8a.5.5 0 0 1 0 1H5.5z"/>
                    <path d="M16 3a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                </svg>
            </div>
            <div class="brand">SnakApp</div>
        </div>
        
            <div class="headicons">
                <!-- <i class="fa fa-search align-self-center" aria-hidden="true"></i> -->
                <svg class="fa-search align-self-center" width="1.6em" height="1.6em" viewBox="0 0 16 16" class="bi bi-search" fill="#fff">
                    <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
                    <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                </svg>
            </div>
    </nav>

    <!-- No chats section start -->
    {% if length == 0 %}
        <div class='chats text-center'>
            <div class="icon">
                <i class="fas fa-comment-slash"></i>
            </div>
            <div class="nofriends">
                No Chats!
            </div>
            <div class="search-div">
                <button class="search">Search</button>
                <button class="invite">Invite</button>
            </div>
            <div class="create">
                <button class="creategroup">Create New Group</button>
            </div>
        </div>
    <!-- No Chats section end -->
    {% else %}
    <div class="message-box">
    </div>
    {% endif %}
    <!-- 
        <div class="lasttime">
                8:09 pm
            </div>
            <div class="duemsg">
                <div class="pending text-center">3</div>
            </div>
     -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script>
        window.addEventListener( "pageshow", function ( event ) {
            var historyTraversal = event.persisted || 
                                    ( typeof window.performance != "undefined" && 
                                        window.performance.navigation.type === 2 );
            if ( historyTraversal ) {
                // Handle page restore.
                window.location.reload();
            }
        });
        var user = "{{username|escapejs}}"
        $('.greenbox').click(function(){
            window.location.pathname = '/main/profile/' + user + '/view/';
        })
        
        document.onclick = function(event){
            if (event===undefined) event= window.event;
            var target= 'target' in event? event.target : event.srcElement;
            if(target.className == '[object SVGAnimatedString]'){
                $('.sidebar').css({"width" : '77%'});
            }
            if(target.className != 'sidebar' && target.className != 'hamburger d-flex' && target.className != '[object SVGAnimatedString]'){
                $('.sidebar').css({"width" : '0%'});
            }
        }
        $(".search").click(function(){
            window.location.pathname = '/main/search/username/';
        });
        $(".creategroup").click(function(){
            window.location.pathname = '/main/group/participants/';
        });
        $('.newgroup').click(function(){
            window.location.pathname = '/main/group/participants/';
        });
        $('.logout').click(function(){
            window.location.pathname = '/accounts/logout/';
        });
        $('.singleuser').click(function(){
            window.location.pathname = '/main/search/username/';
        });
        $('.fa-search').click(function(){
            window.location.pathname = '/main/search/username/';
        });
        $('.viewprofile').click(function(){
            window.location.pathname = '/main/profile/' + user + '/view/';
        });
    </script>
    <script>
        var chat = JSON.parse("{{chats|escapejs}}");
        var a = $('.message-box');
        var span;
        var g = 0;
        var u = 0;
        for(var i = 0; i < chat.length; i++){
            if(chat[i][2] === 0){
                a.append(
                    '<div class="messages d-flex"><span class="group-icon"></span><div class="group-data align-self-start"><div class="group-name">' + chat[i][0] + '</div><div class="lastmsg">' + chat[i][1] + '</div></div></div>'
                )
                if(chat[i][3] != '-'){
                    var x = document.createElement("IMG");
                    x.setAttribute("src", chat[i][3]);
                    span = document.getElementsByClassName("group-icon")[g];
                    span.appendChild(x);
                }
                else{
                    $($(".group-icon")[g]).css({'background' : '#e8e8e8'});
                }
                g = g + 1;
            }
            else if(chat[i][2] === 1){
                a.append(
                    '<div class="messages d-flex"><span class="group-icon"></span><div class="group-data align-self-start"><div class="group-name">' + chat[i][0] + '</div><div class="lastmsg">Photo</div></div></div>'
                )
                if(chat[i][3] != '-'){
                    var x = document.createElement("IMG");
                    x.setAttribute("src", chat[i][3]);
                    span = document.getElementsByClassName("group-icon")[g];
                    span.appendChild(x);
                }
                else{
                    $($(".group-icon")[g]).css({'background' : '#e8e8e8'});
                }
                g = g + 1;
            }
            else if(chat[i][2] == 2){
                a.append(
                    '<div class="messages d-flex"><span class="user-icon"></span><div class="user-data align-self-start"><div class="user-name">' + chat[i][0] + '</div><div class="lastmsg">' + chat[i][1] + '</div></div></div>'
                )
                if(chat[i][3] != '-'){
                    var x = document.createElement("IMG");
                    x.setAttribute("src", chat[i][3]);
                    span = document.getElementsByClassName("user-icon")[u];
                    span.appendChild(x);
                }
                else{
                    $($(".user-icon")[u]).css({'background' : '#e8e8e8'});
                }
                u = u + 1;
            }
            else if(chat[i][2] == 3){
                a.append(
                    '<div class="messages d-flex"><span class="user-icon"></span><div class="user-data align-self-start"><div class="user-name">' + chat[i][0] + '</div><div class="lastmsg">Photo</div></div></div>'
                )
                if(chat[i][3] != '-'){
                    var x = document.createElement("IMG");
                    x.setAttribute("src", chat[i][3]);
                    span = document.getElementsByClassName("user-icon")[u];
                    span.appendChild(x);
                }
                else{
                    $($(".user-icon")[u]).css({'background' : '#e8e8e8'});
                }
                u = u + 1;
            }
            
        }
        $('.user-data').click(function(){
            var name = $($(this).children($('.user-name'))[0]).text();
            console.log(name)
            if($('.sidebar').css('width') != '0px'){
                $('.sidebar').css({"width" : '0%'});
            }
            else{
                window.location.pathname = '/main/personalchat/' + name + '/';
            }
        });
        $('.group-data').click(function(){
            var groupname = $($(this).children($('.group-name'))[0]).text();
            console.log(groupname)
            
            if($('.sidebar').css('width') != '0px'){
                $('.sidebar').css({"width" : '0%'});
            }
            else{
                window.location.pathname = '/groups/' + groupname + '/chats/';
            }
        });
        $('.user-icon').click(function(){
            var name = $($($(this).parent().children($('.user-name'))[1]).children($('.user-name'))[0]).text();
            if($('.sidebar').css('width') != '0px'){
                $('.sidebar').css({"width" : '0%'});
            }
            else{
                window.location.pathname = '/main/profile/' + name + '/view/';
            }
            
        });
        $('.group-icon').click(function(){
            var name = $($($(this).parent().children($('.group-name'))[1]).children($('.group-name'))[0]).text();
            
            window.location.pathname = '/groups/' + name + '/info/';
        });
        
    </script>
</body>
</html>